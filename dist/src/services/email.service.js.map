{"version":3,"sources":["../../../src/services/email.service.ts"],"sourcesContent":["const nodemailer = require('nodemailer');\nimport { config } from 'dotenv';\n\nconfig();\n\n// Email configuration\nconst EMAIL_HOST = process.env.SMTP_HOST || process.env.EMAIL_HOST || 'smtp.gmail.com';\nconst EMAIL_PORT = parseInt(process.env.SMTP_PORT || process.env.EMAIL_PORT || '587');\nconst EMAIL_SECURE = process.env.EMAIL_SECURE === 'true';\nconst EMAIL_USER = process.env.SMTP_USER || process.env.EMAIL_USER || '';\nconst EMAIL_PASS = process.env.SMTP_PASS || process.env.EMAIL_PASS || '';\nconst EMAIL_FROM = process.env.EMAIL_FROM || '\"Fieldsy\" <noreply@fieldsy.com>';\n\n// Create transporter only if email credentials are provided\nlet transporter: any = null;\n\nif (EMAIL_USER && EMAIL_PASS) {\n  transporter = nodemailer.createTransport({\n    host: EMAIL_HOST,\n    port: EMAIL_PORT,\n    secure: EMAIL_SECURE,\n    auth: {\n      user: EMAIL_USER,\n      pass: EMAIL_PASS,\n    },\n  });\n\n  // Verify transporter connection\n  transporter.verify((error: any, success: boolean) => {\n    if (error) {\n      console.warn('Email service not configured properly:', error.message);\n      console.warn('Emails will not be sent. Please configure EMAIL_USER and EMAIL_PASS in .env');\n    } else {\n      console.log('‚úÖ Email service is ready to send messages');\n    }\n  });\n} else {\n  console.warn('‚ö†Ô∏è Email service disabled: EMAIL_USER or EMAIL_PASS not configured in .env');\n  console.warn('To enable email verification, please set EMAIL_USER and EMAIL_PASS in your .env file');\n}\n\n// Email templates\nconst getOtpEmailTemplate = (otp: string, name?: string) => {\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>Email Verification</title>\n        <style>\n          body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            line-height: 1.6;\n            color: #333333;\n            margin: 0;\n            padding: 0;\n            background-color: #f7f7f7;\n          }\n          .container {\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n            background-color: #ffffff;\n            border-radius: 10px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n          }\n          .header {\n            text-align: center;\n            padding: 20px 0;\n            border-bottom: 2px solid #4CAF50;\n          }\n          .logo {\n            font-size: 32px;\n            font-weight: bold;\n            color: #4CAF50;\n          }\n          .content {\n            padding: 30px 20px;\n            text-align: center;\n          }\n          .otp-code {\n            display: inline-block;\n            font-size: 32px;\n            font-weight: bold;\n            letter-spacing: 8px;\n            color: #4CAF50;\n            background-color: #f0f8f0;\n            padding: 15px 30px;\n            border-radius: 8px;\n            margin: 20px 0;\n          }\n          .footer {\n            text-align: center;\n            padding: 20px;\n            color: #666666;\n            font-size: 14px;\n            border-top: 1px solid #eeeeee;\n          }\n          .button {\n            display: inline-block;\n            padding: 12px 30px;\n            background-color: #4CAF50;\n            color: white;\n            text-decoration: none;\n            border-radius: 25px;\n            margin-top: 20px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <div class=\"logo\">üêæ Fieldsy</div>\n          </div>\n          <div class=\"content\">\n            <h1>Verify Your Email</h1>\n            <p>Hi ${name || 'there'},</p>\n            <p>Thank you for signing up with Fieldsy! Please use the following verification code to complete your registration:</p>\n            <div class=\"otp-code\">${otp}</div>\n            <p><strong>This code will expire in 10 minutes.</strong></p>\n            <p>If you didn't request this verification, please ignore this email.</p>\n          </div>\n          <div class=\"footer\">\n            <p>¬© 2025 Fieldsy. All rights reserved.</p>\n            <p>Find secure fields for your furry friends üêï</p>\n          </div>\n        </div>\n      </body>\n    </html>\n  `;\n};\n\nconst getFieldClaimStatusTemplate = (statusData: {\n  fullName: string;\n  fieldName: string;\n  fieldAddress: string;\n  status: 'APPROVED' | 'REJECTED';\n  reviewNotes?: string;\n  documents?: string[];\n}) => {\n  const isApproved = statusData.status === 'APPROVED';\n  const statusColor = isApproved ? '#4CAF50' : '#f44336';\n  const statusText = isApproved ? 'Approved' : 'Rejected';\n\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>Field Claim ${statusText}</title>\n        <style>\n          body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            line-height: 1.6;\n            color: #333333;\n            margin: 0;\n            padding: 0;\n            background-color: #f7f7f7;\n          }\n          .container {\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n            background-color: #ffffff;\n            border-radius: 10px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n          }\n          .header {\n            text-align: center;\n            padding: 20px 0;\n            border-bottom: 2px solid ${statusColor};\n          }\n          .logo {\n            font-size: 32px;\n            font-weight: bold;\n            color: #4CAF50;\n          }\n          .content {\n            padding: 30px 20px;\n          }\n          .status-badge {\n            display: inline-block;\n            background-color: ${statusColor};\n            color: white;\n            padding: 10px 20px;\n            border-radius: 25px;\n            font-weight: bold;\n            font-size: 18px;\n            margin: 20px 0;\n          }\n          .info-box {\n            background-color: ${isApproved ? '#f0f8f0' : '#fff5f5'};\n            border-left: 4px solid ${statusColor};\n            padding: 15px;\n            margin: 20px 0;\n          }\n          .next-steps {\n            background-color: #fff7e6;\n            border-radius: 8px;\n            padding: 15px;\n            margin: 20px 0;\n          }\n          .next-steps h3 {\n            color: #ff8c00;\n            margin-top: 0;\n          }\n          .footer {\n            text-align: center;\n            padding: 20px;\n            color: #666666;\n            font-size: 14px;\n            border-top: 1px solid #eeeeee;\n          }\n          .button {\n            display: inline-block;\n            padding: 12px 30px;\n            background-color: ${statusColor};\n            color: white;\n            text-decoration: none;\n            border-radius: 25px;\n            margin-top: 20px;\n            font-weight: bold;\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <div class=\"logo\">üêæ Fieldsy</div>\n          </div>\n          <div class=\"content\">\n            <h1>Field Claim ${statusText}</h1>\n            <p>Dear ${statusData.fullName},</p>\n            \n            ${isApproved ? `\n              <p>Great news! Your claim for the field has been <strong>approved</strong>. You can now manage your field listing on Fieldsy.</p>\n            ` : `\n              <p>We regret to inform you that your claim for the field has been <strong>rejected</strong> after careful review.</p>\n            `}\n            \n            <div class=\"status-badge\">Status: ${statusText}</div>\n            \n            <div class=\"info-box\">\n              <h3>Field Details:</h3>\n              <p><strong>Field Name:</strong> ${statusData.fieldName}</p>\n              <p><strong>Location:</strong> ${statusData.fieldAddress}</p>\n              ${statusData.reviewNotes ? `\n                <p><strong>Review Notes:</strong> ${statusData.reviewNotes}</p>\n              ` : ''}\n            </div>\n            \n            ${statusData.documents && statusData.documents.length > 0 && isApproved ? `\n            <div class=\"info-box\">\n              <h3>Your Submitted Documents:</h3>\n              <p style=\"margin-bottom: 10px; color: #666;\">For your reference, these were the documents you submitted:</p>\n              <ul style=\"margin: 10px 0; padding-left: 20px;\">\n                ${statusData.documents.map((doc, index) => {\n                  const fileName = doc.split('/').pop() || `Document ${index + 1}`;\n                  const isFullUrl = doc.startsWith('http://') || doc.startsWith('https://');\n                  return `\n                    <li style=\"margin: 8px 0;\">\n                      ${isFullUrl ? \n                        `<a href=\"${doc}\" style=\"color: #4CAF50; text-decoration: none; font-weight: 500;\" target=\"_blank\">${fileName}</a>` :\n                        `<span style=\"color: #555;\">${fileName}</span>`\n                      }\n                    </li>\n                  `;\n                }).join('')}\n              </ul>\n            </div>\n            ` : ''}\n            \n            ${isApproved ? `\n              <div class=\"next-steps\">\n                <h3>üéâ What's Next?</h3>\n                <ul>\n                  <li>Log in to your Fieldsy account to manage your field</li>\n                  <li>Update your field details and pricing</li>\n                  <li>Add high-quality photos to attract more bookings</li>\n                  <li>Set your availability and booking rules</li>\n                  <li>Start receiving bookings from dog owners!</li>\n                </ul>\n              </div>\n              \n              <p>Congratulations on becoming a Fieldsy field owner! We're excited to have you as part of our community.</p>\n            ` : `\n              <div class=\"next-steps\">\n                <h3>üìã What Can You Do?</h3>\n                <ul>\n                  <li>Review the rejection reason provided above</li>\n                  <li>Gather additional documentation if needed</li>\n                  <li>Contact our support team for clarification</li>\n                  <li>Submit a new claim with updated information</li>\n                </ul>\n              </div>\n              \n              <p>If you believe this decision was made in error or have additional documentation to provide, please contact our support team.</p>\n            `}\n          </div>\n          <div class=\"footer\">\n            <p>¬© 2025 Fieldsy. All rights reserved.</p>\n            <p>Find secure fields for your furry friends üêï</p>\n          </div>\n        </div>\n      </body>\n    </html>\n  `;\n};\n\nconst getFieldClaimTemplate = (claimData: {\n  fullName: string;\n  email: string;\n  phoneNumber: string;\n  fieldName: string;\n  fieldAddress: string;\n  isLegalOwner: boolean;\n  submittedAt: Date;\n  documents?: string[];\n}) => {\n  const formattedDate = new Date(claimData.submittedAt).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>Field Claim Confirmation</title>\n        <style>\n          body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            line-height: 1.6;\n            color: #333333;\n            margin: 0;\n            padding: 0;\n            background-color: #f7f7f7;\n          }\n          .container {\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n            background-color: #ffffff;\n            border-radius: 10px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n          }\n          .header {\n            text-align: center;\n            padding: 20px 0;\n            border-bottom: 2px solid #4CAF50;\n          }\n          .logo {\n            font-size: 32px;\n            font-weight: bold;\n            color: #4CAF50;\n          }\n          .content {\n            padding: 30px 20px;\n          }\n          .status-badge {\n            display: inline-block;\n            background-color: #FFA500;\n            color: white;\n            padding: 8px 16px;\n            border-radius: 20px;\n            font-weight: bold;\n            margin: 15px 0;\n          }\n          .info-box {\n            background-color: #f0f8f0;\n            border-left: 4px solid #4CAF50;\n            padding: 15px;\n            margin: 20px 0;\n          }\n          .info-item {\n            margin: 10px 0;\n          }\n          .info-label {\n            font-weight: bold;\n            color: #555;\n          }\n          .footer {\n            text-align: center;\n            padding: 20px;\n            color: #666666;\n            font-size: 14px;\n            border-top: 1px solid #eeeeee;\n          }\n          .next-steps {\n            background-color: #fff7e6;\n            border-radius: 8px;\n            padding: 15px;\n            margin: 20px 0;\n          }\n          .next-steps h3 {\n            color: #ff8c00;\n            margin-top: 0;\n          }\n          .next-steps ul {\n            margin: 10px 0;\n            padding-left: 20px;\n          }\n          .next-steps li {\n            margin: 8px 0;\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <div class=\"logo\">üêæ Fieldsy</div>\n          </div>\n          <div class=\"content\">\n            <h1>Field Claim Submission Received</h1>\n            <p>Dear ${claimData.fullName},</p>\n            <p>Thank you for submitting your claim for the field. We have successfully received your submission and our team will review it shortly.</p>\n            \n            <div class=\"status-badge\">Status: Under Review</div>\n            \n            <div class=\"info-box\">\n              <h3>Claim Details:</h3>\n              <div class=\"info-item\">\n                <span class=\"info-label\">Field Name:</span> ${claimData.fieldName}\n              </div>\n              <div class=\"info-item\">\n                <span class=\"info-label\">Field Location:</span> ${claimData.fieldAddress}\n              </div>\n              <div class=\"info-item\">\n                <span class=\"info-label\">Submitted By:</span> ${claimData.fullName}\n              </div>\n              <div class=\"info-item\">\n                <span class=\"info-label\">Contact Email:</span> ${claimData.email}\n              </div>\n              <div class=\"info-item\">\n                <span class=\"info-label\">Phone Number:</span> ${claimData.phoneNumber}\n              </div>\n              <div class=\"info-item\">\n                <span class=\"info-label\">Legal Owner:</span> ${claimData.isLegalOwner ? 'Yes' : 'No'}\n              </div>\n              <div class=\"info-item\">\n                <span class=\"info-label\">Submission Date:</span> ${formattedDate}\n              </div>\n            </div>\n            \n            ${claimData.documents && claimData.documents.length > 0 ? `\n            <div class=\"info-box\">\n              <h3>Submitted Documents:</h3>\n              <p style=\"margin-bottom: 10px; color: #666;\">The following ownership documents were submitted with your claim:</p>\n              <ul style=\"margin: 10px 0; padding-left: 20px;\">\n                ${claimData.documents.map((doc, index) => {\n                  // Extract filename from URL or path\n                  const fileName = doc.split('/').pop() || `Document ${index + 1}`;\n                  // Check if it's a full URL or just a path\n                  const isFullUrl = doc.startsWith('http://') || doc.startsWith('https://');\n                  return `\n                    <li style=\"margin: 8px 0;\">\n                      ${isFullUrl ? \n                        `<a href=\"${doc}\" style=\"color: #4CAF50; text-decoration: none; font-weight: 500;\" target=\"_blank\">${fileName}</a>` :\n                        `<span style=\"color: #555;\">${fileName}</span>`\n                      }\n                    </li>\n                  `;\n                }).join('')}\n              </ul>\n              <p style=\"margin-top: 10px; font-size: 12px; color: #888;\">\n                <em>Note: These documents are securely stored and will be reviewed by our verification team.</em>\n              </p>\n            </div>\n            ` : ''}\n            \n            <div class=\"next-steps\">\n              <h3>üìã What Happens Next?</h3>\n              <ul>\n                <li>Our verification team will review your submitted documents</li>\n                <li>We may contact you if additional information is needed</li>\n                <li>You will receive an email notification once your claim is approved or if we need more information</li>\n                <li>The typical review process takes 2-3 business days</li>\n              </ul>\n            </div>\n            \n            <p><strong>Important:</strong> Please ensure your submitted ownership documents are valid and up-to-date. If we cannot verify your ownership, we may need to request additional documentation.</p>\n            \n            <p>If you have any questions about your claim or need to provide additional information, please don't hesitate to contact our support team.</p>\n            \n            <p>Thank you for choosing Fieldsy to list your field!</p>\n          </div>\n          <div class=\"footer\">\n            <p>¬© 2025 Fieldsy. All rights reserved.</p>\n            <p>Find secure fields for your furry friends üêï</p>\n            <p>This is an automated confirmation email. Please do not reply directly to this message.</p>\n          </div>\n        </div>\n      </body>\n    </html>\n  `;\n};\n\nconst getPasswordResetTemplate = (otp: string, name?: string) => {\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>Password Reset</title>\n        <style>\n          body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            line-height: 1.6;\n            color: #333333;\n            margin: 0;\n            padding: 0;\n            background-color: #f7f7f7;\n          }\n          .container {\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n            background-color: #ffffff;\n            border-radius: 10px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n          }\n          .header {\n            text-align: center;\n            padding: 20px 0;\n            border-bottom: 2px solid #4CAF50;\n          }\n          .logo {\n            font-size: 32px;\n            font-weight: bold;\n            color: #4CAF50;\n          }\n          .content {\n            padding: 30px 20px;\n            text-align: center;\n          }\n          .otp-code {\n            display: inline-block;\n            font-size: 32px;\n            font-weight: bold;\n            letter-spacing: 8px;\n            color: #4CAF50;\n            background-color: #f0f8f0;\n            padding: 15px 30px;\n            border-radius: 8px;\n            margin: 20px 0;\n          }\n          .footer {\n            text-align: center;\n            padding: 20px;\n            color: #666666;\n            font-size: 14px;\n            border-top: 1px solid #eeeeee;\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <div class=\"logo\">üêæ Fieldsy</div>\n          </div>\n          <div class=\"content\">\n            <h1>Password Reset Request</h1>\n            <p>Hi ${name || 'there'},</p>\n            <p>We received a request to reset your password. Please use the following code to proceed:</p>\n            <div class=\"otp-code\">${otp}</div>\n            <p><strong>This code will expire in 10 minutes.</strong></p>\n            <p>If you didn't request a password reset, please ignore this email and your password will remain unchanged.</p>\n          </div>\n          <div class=\"footer\">\n            <p>¬© 2025 Fieldsy. All rights reserved.</p>\n            <p>Find secure fields for your furry friends üêï</p>\n          </div>\n        </div>\n      </body>\n    </html>\n  `;\n};\n\n// Email service class\nclass EmailService {\n  async sendMail(to: string, subject: string, html: string): Promise<boolean> {\n    if (!transporter) {\n      console.warn(`‚ö†Ô∏è Email service disabled. OTP for ${to}: ${html.match(/\\d{6}/)}`);\n      console.warn('Configure EMAIL_USER and EMAIL_PASS in .env to enable email sending');\n      return false;\n    }\n\n    try {\n      const info = await transporter.sendMail({\n        from: EMAIL_FROM,\n        to,\n        subject,\n        html,\n      });\n\n      console.log('‚úÖ Email sent successfully:', info.messageId);\n      return true;\n    } catch (error: any) {\n      console.error('‚ùå Failed to send email:', error.message);\n      throw new Error('Failed to send email');\n    }\n  }\n\n  async sendOtpEmail(email: string, otp: string, type: 'SIGNUP' | 'RESET_PASSWORD' | 'EMAIL_VERIFICATION', name?: string): Promise<boolean> {\n    let subject: string;\n    let html: string;\n\n    switch (type) {\n      case 'RESET_PASSWORD':\n        subject = 'Password Reset - Fieldsy';\n        html = getPasswordResetTemplate(otp, name);\n        break;\n      case 'SIGNUP':\n      case 'EMAIL_VERIFICATION':\n      default:\n        subject = 'Email Verification - Fieldsy';\n        html = getOtpEmailTemplate(otp, name);\n        break;\n    }\n\n    return this.sendMail(email, subject, html);\n  }\n\n  async sendFieldClaimEmail(claimData: {\n    fullName: string;\n    email: string;\n    phoneNumber: string;\n    fieldName: string;\n    fieldAddress: string;\n    isLegalOwner: boolean;\n    submittedAt: Date;\n    documents?: string[];\n  }): Promise<boolean> {\n    const subject = 'Field Claim Submitted - Fieldsy';\n    const html = getFieldClaimTemplate(claimData);\n    \n    try {\n      const result = await this.sendMail(claimData.email, subject, html);\n      console.log(`‚úÖ Field claim confirmation email sent to ${claimData.email}`);\n      return result;\n    } catch (error) {\n      console.error(`‚ùå Failed to send field claim email to ${claimData.email}:`, error);\n      // Don't throw error to prevent claim submission from failing\n      return false;\n    }\n  }\n\n  async sendFieldClaimStatusEmail(statusData: {\n    email: string;\n    fullName: string;\n    fieldName: string;\n    fieldAddress: string;\n    status: 'APPROVED' | 'REJECTED';\n    reviewNotes?: string;\n    documents?: string[];\n  }): Promise<boolean> {\n    const statusText = statusData.status === 'APPROVED' ? 'Approved' : 'Rejected';\n    const subject = `Field Claim ${statusText} - Fieldsy`;\n    const html = getFieldClaimStatusTemplate({\n      fullName: statusData.fullName,\n      fieldName: statusData.fieldName,\n      fieldAddress: statusData.fieldAddress,\n      status: statusData.status,\n      reviewNotes: statusData.reviewNotes,\n      documents: statusData.documents\n    });\n    \n    try {\n      const result = await this.sendMail(statusData.email, subject, html);\n      console.log(`‚úÖ Field claim ${statusText.toLowerCase()} email sent to ${statusData.email}`);\n      return result;\n    } catch (error) {\n      console.error(`‚ùå Failed to send field claim status email to ${statusData.email}:`, error);\n      // Don't throw error to prevent status update from failing\n      return false;\n    }\n  }\n}\n\nexport const emailService = new EmailService();"],"names":["emailService","nodemailer","require","config","EMAIL_HOST","process","env","SMTP_HOST","EMAIL_PORT","parseInt","SMTP_PORT","EMAIL_SECURE","EMAIL_USER","SMTP_USER","EMAIL_PASS","SMTP_PASS","EMAIL_FROM","transporter","createTransport","host","port","secure","auth","user","pass","verify","error","success","console","warn","message","log","getOtpEmailTemplate","otp","name","getFieldClaimStatusTemplate","statusData","isApproved","status","statusColor","statusText","fullName","fieldName","fieldAddress","reviewNotes","documents","length","map","doc","index","fileName","split","pop","isFullUrl","startsWith","join","getFieldClaimTemplate","claimData","formattedDate","Date","submittedAt","toLocaleDateString","year","month","day","hour","minute","email","phoneNumber","isLegalOwner","getPasswordResetTemplate","EmailService","sendMail","to","subject","html","match","info","from","messageId","Error","sendOtpEmail","type","sendFieldClaimEmail","result","sendFieldClaimStatusEmail","toLowerCase"],"mappings":";;;;+BA+qBaA;;;eAAAA;;;wBA9qBU;AADvB,MAAMC,aAAaC,QAAQ;AAG3BC,IAAAA,cAAM;AAEN,sBAAsB;AACtB,MAAMC,aAAaC,QAAQC,GAAG,CAACC,SAAS,IAAIF,QAAQC,GAAG,CAACF,UAAU,IAAI;AACtE,MAAMI,aAAaC,SAASJ,QAAQC,GAAG,CAACI,SAAS,IAAIL,QAAQC,GAAG,CAACE,UAAU,IAAI;AAC/E,MAAMG,eAAeN,QAAQC,GAAG,CAACK,YAAY,KAAK;AAClD,MAAMC,aAAaP,QAAQC,GAAG,CAACO,SAAS,IAAIR,QAAQC,GAAG,CAACM,UAAU,IAAI;AACtE,MAAME,aAAaT,QAAQC,GAAG,CAACS,SAAS,IAAIV,QAAQC,GAAG,CAACQ,UAAU,IAAI;AACtE,MAAME,aAAaX,QAAQC,GAAG,CAACU,UAAU,IAAI;AAE7C,4DAA4D;AAC5D,IAAIC,cAAmB;AAEvB,IAAIL,cAAcE,YAAY;IAC5BG,cAAchB,WAAWiB,eAAe,CAAC;QACvCC,MAAMf;QACNgB,MAAMZ;QACNa,QAAQV;QACRW,MAAM;YACJC,MAAMX;YACNY,MAAMV;QACR;IACF;IAEA,gCAAgC;IAChCG,YAAYQ,MAAM,CAAC,CAACC,OAAYC;QAC9B,IAAID,OAAO;YACTE,QAAQC,IAAI,CAAC,0CAA0CH,MAAMI,OAAO;YACpEF,QAAQC,IAAI,CAAC;QACf,OAAO;YACLD,QAAQG,GAAG,CAAC;QACd;IACF;AACF,OAAO;IACLH,QAAQC,IAAI,CAAC;IACbD,QAAQC,IAAI,CAAC;AACf;AAEA,kBAAkB;AAClB,MAAMG,sBAAsB,CAACC,KAAaC;IACxC,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kBA0EQ,EAAEA,QAAQ,QAAQ;;kCAEF,EAAED,IAAI;;;;;;;;;;;EAWtC,CAAC;AACH;AAEA,MAAME,8BAA8B,CAACC;IAQnC,MAAMC,aAAaD,WAAWE,MAAM,KAAK;IACzC,MAAMC,cAAcF,aAAa,YAAY;IAC7C,MAAMG,aAAaH,aAAa,aAAa;IAE7C,OAAO,CAAC;;;;;;2BAMiB,EAAEG,WAAW;;;;;;;;;;;;;;;;;;;;;qCAqBH,EAAED,YAAY;;;;;;;;;;;;8BAYrB,EAAEA,YAAY;;;;;;;;;8BASd,EAAEF,aAAa,YAAY,UAAU;mCAChC,EAAEE,YAAY;;;;;;;;;;;;;;;;;;;;;;;;8BAwBnB,EAAEA,YAAY;;;;;;;;;;;;;;;4BAehB,EAAEC,WAAW;oBACrB,EAAEJ,WAAWK,QAAQ,CAAC;;YAE9B,EAAEJ,aAAa,CAAC;;YAEhB,CAAC,GAAG,CAAC;;YAEL,CAAC,CAAC;;8CAEgC,EAAEG,WAAW;;;;8CAIb,EAAEJ,WAAWM,SAAS,CAAC;4CACzB,EAAEN,WAAWO,YAAY,CAAC;cACxD,EAAEP,WAAWQ,WAAW,GAAG,CAAC;kDACQ,EAAER,WAAWQ,WAAW,CAAC;cAC7D,CAAC,GAAG,GAAG;;;YAGT,EAAER,WAAWS,SAAS,IAAIT,WAAWS,SAAS,CAACC,MAAM,GAAG,KAAKT,aAAa,CAAC;;;;;gBAKvE,EAAED,WAAWS,SAAS,CAACE,GAAG,CAAC,CAACC,KAAKC;QAC/B,MAAMC,WAAWF,IAAIG,KAAK,CAAC,KAAKC,GAAG,MAAM,CAAC,SAAS,EAAEH,QAAQ,GAAG;QAChE,MAAMI,YAAYL,IAAIM,UAAU,CAAC,cAAcN,IAAIM,UAAU,CAAC;QAC9D,OAAO,CAAC;;sBAEJ,EAAED,YACA,CAAC,SAAS,EAAEL,IAAI,mFAAmF,EAAEE,SAAS,IAAI,CAAC,GACnH,CAAC,2BAA2B,EAAEA,SAAS,OAAO,CAAC,CAChD;;kBAEL,CAAC;IACH,GAAGK,IAAI,CAAC,IAAI;;;YAGhB,CAAC,GAAG,GAAG;;YAEP,EAAElB,aAAa,CAAC;;;;;;;;;;;;;YAahB,CAAC,GAAG,CAAC;;;;;;;;;;;;YAYL,CAAC,CAAC;;;;;;;;;EASZ,CAAC;AACH;AAEA,MAAMmB,wBAAwB,CAACC;IAU7B,MAAMC,gBAAgB,IAAIC,KAAKF,UAAUG,WAAW,EAAEC,kBAAkB,CAAC,SAAS;QAChFC,MAAM;QACNC,OAAO;QACPC,KAAK;QACLC,MAAM;QACNC,QAAQ;IACV;IAEA,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;oBA4FU,EAAET,UAAUhB,QAAQ,CAAC;;;;;;;;4DAQmB,EAAEgB,UAAUf,SAAS,CAAC;;;gEAGlB,EAAEe,UAAUd,YAAY,CAAC;;;8DAG3B,EAAEc,UAAUhB,QAAQ,CAAC;;;+DAGpB,EAAEgB,UAAUU,KAAK,CAAC;;;8DAGnB,EAAEV,UAAUW,WAAW,CAAC;;;6DAGzB,EAAEX,UAAUY,YAAY,GAAG,QAAQ,KAAK;;;iEAGpC,EAAEX,cAAc;;;;YAIrE,EAAED,UAAUZ,SAAS,IAAIY,UAAUZ,SAAS,CAACC,MAAM,GAAG,IAAI,CAAC;;;;;gBAKvD,EAAEW,UAAUZ,SAAS,CAACE,GAAG,CAAC,CAACC,KAAKC;QAC9B,oCAAoC;QACpC,MAAMC,WAAWF,IAAIG,KAAK,CAAC,KAAKC,GAAG,MAAM,CAAC,SAAS,EAAEH,QAAQ,GAAG;QAChE,0CAA0C;QAC1C,MAAMI,YAAYL,IAAIM,UAAU,CAAC,cAAcN,IAAIM,UAAU,CAAC;QAC9D,OAAO,CAAC;;sBAEJ,EAAED,YACA,CAAC,SAAS,EAAEL,IAAI,mFAAmF,EAAEE,SAAS,IAAI,CAAC,GACnH,CAAC,2BAA2B,EAAEA,SAAS,OAAO,CAAC,CAChD;;kBAEL,CAAC;IACH,GAAGK,IAAI,CAAC,IAAI;;;;;;YAMhB,CAAC,GAAG,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;EA0BjB,CAAC;AACH;AAEA,MAAMe,2BAA2B,CAACrC,KAAaC;IAC7C,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kBAiEQ,EAAEA,QAAQ,QAAQ;;kCAEF,EAAED,IAAI;;;;;;;;;;;EAWtC,CAAC;AACH;AAEA,sBAAsB;AACtB,MAAMsC;IACJ,MAAMC,SAASC,EAAU,EAAEC,OAAe,EAAEC,IAAY,EAAoB;QAC1E,IAAI,CAAC1D,aAAa;YAChBW,QAAQC,IAAI,CAAC,CAAC,mCAAmC,EAAE4C,GAAG,EAAE,EAAEE,KAAKC,KAAK,CAAC,UAAU;YAC/EhD,QAAQC,IAAI,CAAC;YACb,OAAO;QACT;QAEA,IAAI;YACF,MAAMgD,OAAO,MAAM5D,YAAYuD,QAAQ,CAAC;gBACtCM,MAAM9D;gBACNyD;gBACAC;gBACAC;YACF;YAEA/C,QAAQG,GAAG,CAAC,8BAA8B8C,KAAKE,SAAS;YACxD,OAAO;QACT,EAAE,OAAOrD,OAAY;YACnBE,QAAQF,KAAK,CAAC,2BAA2BA,MAAMI,OAAO;YACtD,MAAM,IAAIkD,MAAM;QAClB;IACF;IAEA,MAAMC,aAAad,KAAa,EAAElC,GAAW,EAAEiD,IAAwD,EAAEhD,IAAa,EAAoB;QACxI,IAAIwC;QACJ,IAAIC;QAEJ,OAAQO;YACN,KAAK;gBACHR,UAAU;gBACVC,OAAOL,yBAAyBrC,KAAKC;gBACrC;YACF,KAAK;YACL,KAAK;YACL;gBACEwC,UAAU;gBACVC,OAAO3C,oBAAoBC,KAAKC;gBAChC;QACJ;QAEA,OAAO,IAAI,CAACsC,QAAQ,CAACL,OAAOO,SAASC;IACvC;IAEA,MAAMQ,oBAAoB1B,SASzB,EAAoB;QACnB,MAAMiB,UAAU;QAChB,MAAMC,OAAOnB,sBAAsBC;QAEnC,IAAI;YACF,MAAM2B,SAAS,MAAM,IAAI,CAACZ,QAAQ,CAACf,UAAUU,KAAK,EAAEO,SAASC;YAC7D/C,QAAQG,GAAG,CAAC,CAAC,yCAAyC,EAAE0B,UAAUU,KAAK,EAAE;YACzE,OAAOiB;QACT,EAAE,OAAO1D,OAAO;YACdE,QAAQF,KAAK,CAAC,CAAC,sCAAsC,EAAE+B,UAAUU,KAAK,CAAC,CAAC,CAAC,EAAEzC;YAC3E,6DAA6D;YAC7D,OAAO;QACT;IACF;IAEA,MAAM2D,0BAA0BjD,UAQ/B,EAAoB;QACnB,MAAMI,aAAaJ,WAAWE,MAAM,KAAK,aAAa,aAAa;QACnE,MAAMoC,UAAU,CAAC,YAAY,EAAElC,WAAW,UAAU,CAAC;QACrD,MAAMmC,OAAOxC,4BAA4B;YACvCM,UAAUL,WAAWK,QAAQ;YAC7BC,WAAWN,WAAWM,SAAS;YAC/BC,cAAcP,WAAWO,YAAY;YACrCL,QAAQF,WAAWE,MAAM;YACzBM,aAAaR,WAAWQ,WAAW;YACnCC,WAAWT,WAAWS,SAAS;QACjC;QAEA,IAAI;YACF,MAAMuC,SAAS,MAAM,IAAI,CAACZ,QAAQ,CAACpC,WAAW+B,KAAK,EAAEO,SAASC;YAC9D/C,QAAQG,GAAG,CAAC,CAAC,cAAc,EAAES,WAAW8C,WAAW,GAAG,eAAe,EAAElD,WAAW+B,KAAK,EAAE;YACzF,OAAOiB;QACT,EAAE,OAAO1D,OAAO;YACdE,QAAQF,KAAK,CAAC,CAAC,6CAA6C,EAAEU,WAAW+B,KAAK,CAAC,CAAC,CAAC,EAAEzC;YACnF,0DAA0D;YAC1D,OAAO;QACT;IACF;AACF;AAEO,MAAM1B,eAAe,IAAIuE"}